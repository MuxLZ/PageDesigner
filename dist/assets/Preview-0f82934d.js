import{d as z,r as p,G as J,H as _,o as d,c as g,b as u,e as o,w as t,I as c,g as f,u as S,t as T,l as I,Z as M,v as F,K as V,E as $,X as D,T as A,i as G,W as H,a1 as K,a4 as W,a5 as X,a6 as Z,a7 as Q,a8 as Y,a9 as ee,_ as oe}from"./index-2031c691.js";import{C as y,P as le}from"./PageRenderer-12124296.js";/* empty css                  *//* empty css                           *//* empty css                         *//* empty css                    *//* empty css                 */const ae={class:"preview-page"},te={key:0,class:"preview-loader"},se={class:"loader-container"},ne={key:0,class:"error-message"},re={key:1,class:"preview-content"},ie={class:"toolbar-left"},ue={class:"page-name"},de={class:"toolbar-right"},ce=z({__name:"Preview",setup(fe){const C=F(),b=V(),a=p(null),i=p(""),L=p(),m=p(!1),n=p(!0);let w=null;J(()=>{k(),x()});const k=()=>{try{const l=localStorage.getItem("pageConfig");m.value=!!l}catch{m.value=!1}},x=()=>{const l=b.query.config;if(l)try{const e=decodeURIComponent(l),s=y.importConfig(e);a.value=s,_.success("配置加载成功"),setTimeout(()=>{n.value=!1},3e3)}catch(e){i.value="从URL加载配置失败："+(e.message||"配置格式错误")}},E=l=>{const e=new FileReader;e.onload=s=>{try{const r=y.importConfig(s.target.result);a.value=r,localStorage.setItem("pageConfig",JSON.stringify(r)),m.value=!0,C.replace({query:{...b.query,config:encodeURIComponent(JSON.stringify(r))}}),_.success("配置加载成功"),i.value="",setTimeout(()=>{n.value=!1},3e3)}catch(r){i.value="加载配置失败："+(r.message||"配置文件格式错误"),a.value=null}},e.onerror=()=>{i.value="读取文件失败",a.value=null},e.readAsText(l.raw)},N=()=>{try{const l=localStorage.getItem("pageConfig");if(l){const e=y.importConfig(l);a.value=e,_.success("从本地存储加载成功"),i.value="",setTimeout(()=>{n.value=!1},3e3)}else _.warning("本地存储中没有配置")}catch(l){i.value="从本地存储加载失败："+(l.message||"配置格式错误")}},U=()=>{if(!a.value)return;const l=y.exportConfig(a.value),e=new Blob([l],{type:"application/json"}),s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download=`${a.value.name}.json`,r.click(),URL.revokeObjectURL(s),_.success("配置已下载")},j=()=>{a.value=null,i.value="",C.replace({query:{}}),k()},O=()=>{a.value&&(localStorage.setItem("pageConfig",JSON.stringify(a.value)),C.push({path:"/designer",query:{loadConfig:"true"}}))},P=()=>{n.value=!n.value},h=()=>{w&&clearTimeout(w),w=window.setTimeout(()=>{n.value=!1},1e3)};return(l,e)=>{const s=$,r=D,B=A,v=G,q=H;return d(),g("div",ae,[a.value?(d(),g("div",re,[u("div",{class:M(["preview-toolbar",{"toolbar-hidden":!n.value}]),onMouseenter:e[1]||(e[1]=R=>n.value=!0),onMouseleave:h},[u("div",ie,[u("span",ue,T(a.value.name),1)]),u("div",de,[o(v,{size:"small",onClick:U},{default:t(()=>[o(s,null,{default:t(()=>[o(c(W))]),_:1}),e[9]||(e[9]=f(" 下载配置 "))]),_:1,__:[9]}),o(v,{size:"small",onClick:j},{default:t(()=>[o(s,null,{default:t(()=>[o(c(X))]),_:1}),e[10]||(e[10]=f(" 重新加载 "))]),_:1,__:[10]}),o(v,{size:"small",type:"primary",onClick:O},{default:t(()=>[o(s,null,{default:t(()=>[o(c(Z))]),_:1}),e[11]||(e[11]=f(" 在设计器中编辑 "))]),_:1,__:[11]}),o(v,{size:"small",onClick:P},{default:t(()=>[o(s,null,{default:t(()=>[n.value?(d(),I(c(Q),{key:0})):(d(),I(c(Y),{key:1}))]),_:1}),f(" "+T(n.value?"隐藏":"显示"),1)]),_:1})])],34),n.value?S("",!0):(d(),g("div",{key:0,class:"toolbar-toggle-btn",onClick:e[2]||(e[2]=R=>n.value=!0)},[o(s,null,{default:t(()=>[o(c(ee))]),_:1})])),o(le,{config:a.value,selectable:!1,"is-designer":!1},null,8,["config"])])):(d(),g("div",te,[u("div",se,[e[7]||(e[7]=u("h2",null,"页面预览",-1)),e[8]||(e[8]=u("p",{class:"loader-description"},"请上传您的页面配置文件（JSON格式）",-1)),o(r,{ref_key:"uploadRef",ref:L,"auto-upload":!1,"on-change":E,"show-file-list":!1,accept:".json,application/json",drag:""},{tip:t(()=>e[3]||(e[3]=[u("div",{class:"el-upload__tip"}," 支持 JSON 格式的页面配置文件 ",-1)])),default:t(()=>[o(s,{class:"el-icon--upload"},{default:t(()=>[o(c(K))]),_:1}),e[4]||(e[4]=u("div",{class:"el-upload__text"},[f(" 将文件拖到此处，或"),u("em",null,"点击上传")],-1))]),_:1,__:[4]},512),o(B,null,{default:t(()=>e[5]||(e[5]=[f("或者")])),_:1,__:[5]}),o(v,{type:"primary",onClick:N,disabled:!m.value},{default:t(()=>e[6]||(e[6]=[f(" 从本地存储加载 ")])),_:1,__:[6]},8,["disabled"]),i.value?(d(),g("div",ne,[o(q,{title:i.value,type:"error",closable:!0,onClose:e[0]||(e[0]=R=>i.value="")},null,8,["title"])])):S("",!0)])]))])}}});const we=oe(ce,[["__scopeId","data-v-49aa4014"]]);export{we as default};
